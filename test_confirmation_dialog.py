"""
æµ‹è¯•ç¡®è®¤å¯¹è¯æ¡†æ˜¾ç¤º
"""

import sys
from pathlib import Path
sys.path.insert(0, str(Path(__file__).parent / "src"))

from gui import show_confirmation_dialog


def test_first_confirmation():
    """æµ‹è¯•å¼€å§‹å‰ç¡®è®¤å¯¹è¯æ¡†"""
    print("=" * 70)
    print("æµ‹è¯•ï¼šå¼€å§‹å‰ç¡®è®¤å¯¹è¯æ¡†")
    print("=" * 70)

    message = """è¯·åœ¨æµè§ˆå™¨ä¸­ç¡®è®¤ä»¥ä¸‹ä¿¡æ¯ï¼š

1. è¯·æ‰‹åŠ¨è¾“å…¥æŠ¥è¡¨æ—¥æœŸ
2. è¯·æ‰‹åŠ¨è¾“å…¥é—¨è¯Šæ€»é‡
3. ç¡®è®¤æ‰€æœ‰ä¿¡æ¯æ— è¯¯åï¼Œç‚¹å‡»"æˆ‘å·²å®Œæˆï¼Œç»§ç»­"æŒ‰é’®

ç¨‹åºå°†ç»§ç»­è‡ªåŠ¨å¡«å†™è¡¨å•æ•°æ®ã€‚"""

    print("\nå³å°†æ˜¾ç¤ºå¯¹è¯æ¡†...")
    print("\nè¯·æ£€æŸ¥ï¼š")
    print("âœ“ æ‰€æœ‰æ–‡å­—æ˜¯å¦å®Œæ•´æ˜¾ç¤º")
    print("âœ“ çª—å£å³ä¾§æ˜¯å¦æœ‰æ»šåŠ¨æ¡")
    print("âœ“ åº•éƒ¨æ˜¯å¦æœ‰è“è‰²çš„'æˆ‘å·²å®Œæˆï¼Œç»§ç»­'æŒ‰é’®")
    print("âœ“ å¯ä»¥ä½¿ç”¨é¼ æ ‡æ»šè½®æ»šåŠ¨æŸ¥çœ‹æ‰€æœ‰å†…å®¹")
    print("âœ“ å¯ä»¥æ‹–åŠ¨çª—å£è¾¹ç¼˜è°ƒæ•´å¤§å°")
    print("-" * 70)

    input("æŒ‰å›è½¦é”®æ˜¾ç¤ºå¯¹è¯æ¡†...")

    confirmed = show_confirmation_dialog("å¼€å§‹å‰ç¡®è®¤", message)

    if confirmed:
        print("\nâœ“ ç”¨æˆ·ç‚¹å‡»äº†'æˆ‘å·²å®Œæˆï¼Œç»§ç»­'æŒ‰é’®")
    else:
        print("\nâœ— å¯¹è¯æ¡†è¢«å…³é—­")

    return confirmed


def test_final_confirmation():
    """æµ‹è¯•å®Œæˆåç¡®è®¤å¯¹è¯æ¡†"""
    print("\n" + "=" * 70)
    print("æµ‹è¯•ï¼šå®Œæˆåç¡®è®¤å¯¹è¯æ¡†")
    print("=" * 70)

    # æ¨¡æ‹ŸçœŸå®çš„æ–‡ä»¶è·¯å¾„
    from pathlib import Path
    result_file_path = Path("C:/workspace/code/myself/sihuo/2025-10/3027314785125921867/output/outpatient_results_20251107_143025.xlsx").absolute()

    message = f"""æ•°æ®å¡«å†™å®Œæˆï¼

æ€»è®¡ï¼š100 æ¡
æˆåŠŸï¼š95 æ¡
å¤±è´¥ï¼š5 æ¡

ğŸ“„ ç»“æœå·²ä¿å­˜åˆ°:
{result_file_path}

è¯·åœ¨æµè§ˆå™¨ä¸­æ£€æŸ¥å¡«å†™ç»“æœï¼Œç¡®è®¤æ— è¯¯åï¼š
1. æ‰‹åŠ¨ç‚¹å‡»"ä¸ŠæŠ¥"æŒ‰é’®
2. ç­‰å¾…ä¸ŠæŠ¥å®Œæˆ
3. ç‚¹å‡»"æˆ‘å·²å®Œæˆï¼Œç»§ç»­"æŒ‰é’®

ç‚¹å‡»æŒ‰é’®åï¼š
â€¢ æµè§ˆå™¨å°†è‡ªåŠ¨å…³é—­
â€¢ ç»“æœæ–‡ä»¶å¤¹å°†è‡ªåŠ¨æ‰“å¼€"""

    print("\nå³å°†æ˜¾ç¤ºå¯¹è¯æ¡†...")
    print("\nè¯·æ£€æŸ¥ï¼š")
    print("âœ“ æ‰€æœ‰ç»Ÿè®¡ä¿¡æ¯æ˜¯å¦å®Œæ•´æ˜¾ç¤º")
    print("âœ“ ç»“æœæ–‡ä»¶è·¯å¾„æ˜¯å¦æ¸…æ™°å¯è§")
    print("âœ“ æ‰€æœ‰æ“ä½œæ­¥éª¤æ˜¯å¦æ¸…æ™°å¯è§")
    print("âœ“ åº•éƒ¨æŒ‰é’®æ˜¯å¦å¯è§")
    print("âœ“ æç¤ºäº†æµè§ˆå™¨ä¼šå…³é—­å’Œæ–‡ä»¶å¤¹ä¼šè‡ªåŠ¨æ‰“å¼€")
    print("-" * 70)

    input("æŒ‰å›è½¦é”®æ˜¾ç¤ºå¯¹è¯æ¡†...")

    confirmed = show_confirmation_dialog("ä¸ŠæŠ¥ç¡®è®¤", message)

    if confirmed:
        print("\nâœ“ ç”¨æˆ·ç‚¹å‡»äº†'æˆ‘å·²å®Œæˆï¼Œç»§ç»­'æŒ‰é’®")
        print("âœ“ æ­¤æ—¶æµè§ˆå™¨ä¼šè‡ªåŠ¨å…³é—­")
        print("âœ“ ç»“æœæ–‡ä»¶å¤¹ä¼šè‡ªåŠ¨æ‰“å¼€")
    else:
        print("\nâœ— å¯¹è¯æ¡†è¢«å…³é—­")

    return confirmed


def main():
    """ä¸»æµ‹è¯•å‡½æ•°"""
    print("\nç¡®è®¤å¯¹è¯æ¡†æ˜¾ç¤ºæµ‹è¯•\n")

    # æµ‹è¯•ç¬¬ä¸€ä¸ªç¡®è®¤å¯¹è¯æ¡†
    if not test_first_confirmation():
        print("\næµ‹è¯•ä¸­æ–­")
        return

    # æµ‹è¯•ç¬¬äºŒä¸ªç¡®è®¤å¯¹è¯æ¡†
    test_final_confirmation()

    print("\n" + "=" * 70)
    print("æ‰€æœ‰æµ‹è¯•å®Œæˆ")
    print("=" * 70)
    print("\nå¦‚æœå†…å®¹æ˜¾ç¤ºä¸å…¨ï¼Œè¯·ï¼š")
    print("1. ä½¿ç”¨é¼ æ ‡æ»šè½®å‘ä¸‹æ»šåŠ¨")
    print("2. æ‹–åŠ¨å³ä¾§çš„æ»šåŠ¨æ¡")
    print("3. æ‹–åŠ¨çª—å£è¾¹ç¼˜æ”¾å¤§çª—å£")
    print("=" * 70)


if __name__ == "__main__":
    main()
